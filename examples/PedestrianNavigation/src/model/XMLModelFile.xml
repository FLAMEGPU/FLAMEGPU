<?xml version="1.0" encoding="utf-8"?>
<gpu:xmodel xmlns:gpu="http://www.dcs.shef.ac.uk/~paul/XMMLGPU"
        xmlns="http://www.dcs.shef.ac.uk/~paul/XMML">
    <name>Optional </name>
    <gpu:environment>
    <gpu:constants>
        <gpu:variable>
            <type>float</type>
            <name>EMMISION_RATE_EXIT1</name>
        </gpu:variable> 
        <gpu:variable>
            <type>float</type>
            <name>EMMISION_RATE_EXIT2</name>
        </gpu:variable> 
        <gpu:variable>
            <type>float</type>
            <name>EMMISION_RATE_EXIT3</name>
        </gpu:variable> 
        <gpu:variable>
            <type>float</type>
            <name>EMMISION_RATE_EXIT4</name>
        </gpu:variable> 
        <gpu:variable>
            <type>float</type>
            <name>EMMISION_RATE_EXIT5</name>
        </gpu:variable> 
        <gpu:variable>
            <type>float</type>
            <name>EMMISION_RATE_EXIT6</name>
        </gpu:variable> 
        <gpu:variable>
            <type>float</type>
            <name>EMMISION_RATE_EXIT7</name>
        </gpu:variable> 
        
        <gpu:variable>
            <type>int</type>
            <name>EXIT1_PROBABILITY</name>
        </gpu:variable> 
        <gpu:variable>
            <type>int</type>
            <name>EXIT2_PROBABILITY</name>
        </gpu:variable> 
        <gpu:variable>
            <type>int</type>
            <name>EXIT3_PROBABILITY</name>
        </gpu:variable> 
        <gpu:variable>
            <type>int</type>
            <name>EXIT4_PROBABILITY</name>
        </gpu:variable> 
        <gpu:variable>
            <type>int</type>
            <name>EXIT5_PROBABILITY</name>
        </gpu:variable> 
        <gpu:variable>
            <type>int</type>
            <name>EXIT6_PROBABILITY</name>
        </gpu:variable> 
        <gpu:variable>
            <type>int</type>
            <name>EXIT7_PROBABILITY</name>
        </gpu:variable> 
        
        <gpu:variable>
            <type>int</type>
            <name>EXIT1_STATE</name>
        </gpu:variable> 
        <gpu:variable>
            <type>int</type>
            <name>EXIT2_STATE</name>
        </gpu:variable> 
        <gpu:variable>
            <type>int</type>
            <name>EXIT3_STATE</name>
        </gpu:variable> 
        <gpu:variable>
            <type>int</type>
            <name>EXIT4_STATE</name>
        </gpu:variable> 
        <gpu:variable>
            <type>int</type>
            <name>EXIT5_STATE</name>
        </gpu:variable> 
        <gpu:variable>
            <type>int</type>
            <name>EXIT6_STATE</name>
        </gpu:variable> 
        <gpu:variable>
            <type>int</type>
            <name>EXIT7_STATE</name>
        </gpu:variable> 
        
        <gpu:variable>
            <type>float</type>
            <name>TIME_SCALER</name>
        </gpu:variable> 
        
         <gpu:variable>
            <type>float</type>
            <name>STEER_WEIGHT</name>
        </gpu:variable> 
        <gpu:variable>
            <type>float</type>
            <name>AVOID_WEIGHT</name>
        </gpu:variable> 
        <gpu:variable>
            <type>float</type>
            <name>COLLISION_WEIGHT</name>
        </gpu:variable> 
        <gpu:variable>
            <type>float</type>
            <name>GOAL_WEIGHT</name>
        </gpu:variable> 
        
        
    </gpu:constants>
        <gpu:functionFiles>
            <file>functions.c</file>
        </gpu:functionFiles>
    </gpu:environment>
    <xagents>
        <gpu:xagent>
            <name>agent</name>
            <memory>
                <gpu:variable>
                    <type>float</type>
                    <name>x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>velx</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>vely</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>steer_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>steer_y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>height</name>
                </gpu:variable>
              <gpu:variable>
                <type>int</type>
                <name>exit_no</name>
              </gpu:variable>
              <gpu:variable>
                <type>float</type>
                <name>speed</name>
              </gpu:variable>
                <!-- rendering and animation variables-->
                <gpu:variable>
                    <type>int</type>
                    <name>lod</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>animate</name>
                </gpu:variable>
                <gpu:variable>
                    <type>int</type>
                    <name>animate_dir</name>
                </gpu:variable>
            </memory>
            <functions>

                <gpu:function>
                    <name>output_pedestrian_location</name>
                    <currentState>default</currentState>
                    <nextState>default</nextState>
                    <outputs>
                        <gpu:output>
                            <messageName>pedestrian_location</messageName>
                            <gpu:type>single_message</gpu:type>
                        </gpu:output>
                    </outputs>
                    <gpu:reallocate>false</gpu:reallocate>
                    <gpu:RNG>false</gpu:RNG>
                </gpu:function>

                <gpu:function>
                    <name>avoid_pedestrians</name>
                    <currentState>default</currentState>
                    <nextState>default</nextState>
                    <inputs>
                        <gpu:input>
                            <messageName>pedestrian_location</messageName>
                        </gpu:input>
                    </inputs>
                    <gpu:reallocate>false</gpu:reallocate>
                    <gpu:RNG>true</gpu:RNG>
                </gpu:function>

                <gpu:function>
                    <name>force_flow</name>
                    <currentState>default</currentState>
                    <nextState>default</nextState>
                    <inputs>
                        <gpu:input>
                            <messageName>navmap_cell</messageName>
                        </gpu:input>
                    </inputs>
                    <gpu:reallocate>true</gpu:reallocate>
                    <gpu:RNG>true</gpu:RNG>
                </gpu:function>

                <gpu:function>
                    <name>move</name>
                    <currentState>default</currentState>
                    <nextState>default</nextState>
                    <gpu:reallocate>false</gpu:reallocate>
                    <gpu:RNG>false</gpu:RNG>
                </gpu:function>
            </functions>

            <states>
                <gpu:state>
                    <name>default</name>
                </gpu:state>
                <initialState>default</initialState>
            </states>

            <gpu:type>continuous</gpu:type>
            <gpu:bufferSize>65536</gpu:bufferSize>
        </gpu:xagent>

        <gpu:xagent>
            <name>navmap</name>
            <memory>
                <gpu:variable>
                    <type>int</type>
                    <name>x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>int</type>
                    <name>y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>int</type>
                    <name>exit_no</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>height</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>collision_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>collision_y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit0_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit0_y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit1_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit1_y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit2_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit2_y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit3_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit3_y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit4_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit4_y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit5_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit5_y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit6_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit6_y</name>
                </gpu:variable>
            </memory>
            <functions>
                <gpu:function>
                    <name>output_navmap_cells</name>
                    <currentState>static</currentState>
                    <nextState>static</nextState>
                    <outputs>
                        <gpu:output>
                            <messageName>navmap_cell</messageName>
                            <gpu:type>single_message</gpu:type>
                        </gpu:output>
                    </outputs>
                    <gpu:reallocate>false</gpu:reallocate>
                    <gpu:RNG>false</gpu:RNG>
                </gpu:function>
                <gpu:function>
                    <name>generate_pedestrians</name>
                    <currentState>static</currentState>
                    <nextState>static</nextState>
                    <xagentOutputs>
                        <gpu:xagentOutput>
                            <xagentName>agent</xagentName>
                            <state>default</state>
                        </gpu:xagentOutput>
                    </xagentOutputs>
                    <gpu:reallocate>false</gpu:reallocate>
                    <gpu:RNG>true</gpu:RNG>
                </gpu:function>
            </functions>
            <states>
                <gpu:state>
                    <name>static</name>
                </gpu:state>
                <initialState>static</initialState>
            </states>
            <gpu:type>discrete</gpu:type>
            <gpu:bufferSize>65536</gpu:bufferSize>

        </gpu:xagent>
    </xagents>

    <messages>
        <gpu:message>
            <name>pedestrian_location</name>
            <variables>
                <gpu:variable>
                    <type>float</type>
                    <name>x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>z</name>
                </gpu:variable>
            </variables>
            <gpu:partitioningSpatial>
                <gpu:radius>0.025</gpu:radius>
                <gpu:xmin>-1.0</gpu:xmin>
                <gpu:xmax>1.0</gpu:xmax>
                <gpu:ymin>-1.0</gpu:ymin>
                <gpu:ymax>1.0</gpu:ymax>
                <gpu:zmin>0.0</gpu:zmin>
                <gpu:zmax>0.025</gpu:zmax>
            </gpu:partitioningSpatial>
            <gpu:bufferSize>65536</gpu:bufferSize>
        </gpu:message>

        <gpu:message>
            <name>navmap_cell</name>
            <variables>
                <gpu:variable>
                    <type>int</type>
                    <name>x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>int</type>
                    <name>y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>int</type>
                    <name>exit_no</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>height</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>collision_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>collision_y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit0_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit0_y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit1_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit1_y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit2_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit2_y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit3_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit3_y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit4_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit4_y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit5_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit5_y</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit6_x</name>
                </gpu:variable>
                <gpu:variable>
                    <type>float</type>
                    <name>exit6_y</name>
                </gpu:variable>
            </variables>
            <gpu:partitioningDiscrete>
                <gpu:radius>0</gpu:radius>
            </gpu:partitioningDiscrete>
            <gpu:bufferSize>65536</gpu:bufferSize>
        </gpu:message>

    </messages>

<layers>
    <layer>
        <gpu:layerFunction>
            <name>generate_pedestrians</name>
        </gpu:layerFunction>
    </layer>
    <layer>
        <gpu:layerFunction>
            <name>output_pedestrian_location</name>
        </gpu:layerFunction>
        <gpu:layerFunction>
            <name>output_navmap_cells</name>
        </gpu:layerFunction>
    </layer>
    <layer>
        <gpu:layerFunction>
            <name>avoid_pedestrians</name>
        </gpu:layerFunction>
    </layer>
    <layer>
        <gpu:layerFunction>
            <name>force_flow</name>
        </gpu:layerFunction>
    </layer>
    <layer>
        <gpu:layerFunction>
            <name>move</name>
        </gpu:layerFunction>
    </layer>
</layers>


</gpu:xmodel>
